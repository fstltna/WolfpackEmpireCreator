#!/usr/bin/perl
use strict;
use warnings;

use UI::Dialog;
use Term::ReadKey;
use Term::ANSIScreen qw(cls);

my $FileEditor = "/bin/nano";
my $Pager = "/usr/bin/less";
my $HOME = $ENV{HOME};
my $FairLandSettings = "$HOME/.EmpSettingsDir";
my $MUDLog = "/home/cmowner/CoffeeMud/mud.log";
my $EmpireWorldToolDir = "$HOME/WolfpackEmpireCreator";
chdir $EmpireWorldToolDir;
#my $EmpireWorldToolDir = "WolfpackEmpireCreator";
my $UpdateCommand = "/usr/bin/git pull";
my $DEBUG_MODE = "off";

###################################################
# No changes below here
###################################################

my $EmpireWorldTool_ver = "1.0";

if (! -e $FairLandSettings)
{
	if (! -d $FairLandSettings)
	{
		#mkdir ("$FairLandSettings") || die("Unable to create the settings directory");
		mkdir ("$FairLandSettings");
	}
}
chdir $FairLandSettings;
sub PrintDebugCommand
{
	if ($DEBUG_MODE eq "off")
	{
		return;
	}
	my $PassedString = shift;
	print "About to run:\n$PassedString\n";
	print "Press Enter To Run This:";
	my $entered = <STDIN>;
}

my $d = new UI::Dialog ( backtitle => "EmpireWorldTool v$EmpireWorldTool_ver", height => 20, width => 65, listheight => 5,
	order => [ 'ascii', 'cdialog', 'xdialog' ]);

my $windowtitle = "Welcome to EmpireWorldTool!";
my $enjoyedtitle = "We hope you enjoyed EmpireWorldTool!";
my $introtext =
"This is the EmpireWorldTool, a utility to create Empire
fairland commands for Empire operators to easily create and
store your fairland world creation settings.";

$d->msgbox( title => $windowtitle, text => $introtext );

if (($d->state() eq "ESC") || ($d->state() eq "CANCEL"))
{
	exit 0;
}

my $menuselection = "";

sub DoUpdate
{
	my $DesiredDir = $_[0];

	# Update desired utility
	chdir ($DesiredDir);
	PrintDebugCommand("Running $UpdateCommand in $DesiredDir\n");
	system("$UpdateCommand");
	print "Press Enter To Continue";
	my $entered = <STDIN>;
}

sub UpdateToolsMenu
{
	$menuselection = $d->menu( title => "Update Tools Menu", text => "Select one:",
                            list => [ '1', 'Update EmpireWorldTool',
                                      'q', 'Main Menu' ] );
}

sub UpdateTools
{
	while (-1)
	{
		UpdateToolsMenu();
		if (($menuselection eq "CANCEL") || ($menuselection eq "ESC") || ($menuselection eq "") || ($menuselection eq "q") || ($menuselection eq "Q"))
		{
			return;
		}
		elsif ($menuselection eq "1")
		{
			# Update EmpireWorldTool
			DoUpdate($EmpireWorldToolDir);
		}
	}
}

# fairland command-line arguments
# fairland  [-ahioqv]  [-e configfile] [-R seed] "Number of Contenents" "Contenent Size" "Number of Islands" "Average Size of Islands" "Spike percentage def 10" "Percent of Land that is mountain" "Minimum Distance between contenents" "Minimum Distance from islands to contenents"

my $SettingsName = "";
my $SettingsSeed = "";
my $SettingsNumCont = 0;
my $SettingsContSize = 0;
my $SettingsNumIsl = 0;
my $SettingsAvgSizeIsl = 0;
my $SettingsSpikePct = 0;
my $SettingsPctMountain = 0;
my $SettingsMinDistCont = 0;
my $SettingsMinDistIslands = 0;
my $SettingsConfigFile = "";

sub Add_New_Entry
{
	system ("clear");
	print "Enter Desired Name:";
	$SettingsName = <STDIN>;
}

sub GameSettingsMenu
{
	$menuselection = $d->menu( title => "Game Settings Manager", text => "Select one:",
                            list => [
                                      '1', 'List Settings',
                                      '2', 'Edit coffeemud.ini',
                                      '3', 'View MUD Log',
                                      '4', 'Edit intro.txt',
                                      '5', 'Update EmpireWorldTool',
                                      'q', 'Quit to Main Menu' ] );
}

sub MainMenu
{
	$menuselection = $d->menu( title => "Main Menu", text => "Select one:",
                            list => [
                                      '1', 'List Settings',
                                      '2', 'Edit coffeemud.ini',
                                      '3', 'View MUD Log',
                                      '4', 'Edit intro.txt',
                                      '5', 'Update EmpireWorldTool',
                                      'q', 'Quit EmpireWorldTool' ] );
}

while (-1)
{
	MainMenu();
	if (($menuselection eq "CANCEL") || ($menuselection eq "ESC") || ($menuselection eq "") || ($menuselection eq "q") || ($menuselection eq "Q"))
	{
		$d->msgbox( title => $enjoyedtitle, text => "Thanks for using EmpireWorldTool..." );
		exit 0;
	}
	elsif ($menuselection eq "1")
	{
		# Go to the game list page
		GameSettingsMenu();
	}
	elsif ($menuselection eq "2")
	{
		# Edit coffeemud.ini file
		system("$FileEditor $FairLandSettings/coffeemud.ini");
	}
	elsif ($menuselection eq "3")
	{
                # View the log file
                system("$Pager $MUDLog");
	}
	elsif ($menuselection eq "4")
	{
		# Edit intro.txt file
		system("$FileEditor $FairLandSettings/resources/text/intro.txt");
	}
	elsif ($menuselection eq "5")
	{
		# Update Menu
		UpdateTools();
	}
}

exit 0;
